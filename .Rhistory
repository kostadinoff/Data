rdf$date = as.Date(rdf$date)
costs = rdf %>%
group_by(year_Q) %>%
dplyr::summarise(sum(QV)) %>%
flextable()
costs
plot_Q_cost = rdf %>%
group_by(year_Q) %>%
dplyr::summarise(sum= sum(QV)) %>%
ggplot(aes(year_Q, sum, fill= year_Q))+
geom_col()+
scale_y_continuous(labels=scales::dollar_format(scale = .001, suffix = " мил.лв", prefix = " "))+
coord_flip()+
theme(legend.position="none")+
labs(title= "Разходи на НЗОК за таргетни онкологични медикаменти", subtitle = " в милиони лева, по тримесечие",
y=" ", x= " ")
plot_Q_cost
cost_per_INN =
rdf %>%
group_by(INN, year) %>%
dplyr::summarise(sum= sum(QV)) %>%
ungroup() %>%
mutate(INN = as.factor(INN),
INN = reorder_within(INN, sum, year)) %>%
ggplot(aes(INN, log(sum,10), fill=INN)) +
geom_col()+
facet_wrap(~year, scales = "free_y", ncol = 1)+
coord_flip()+
scale_x_reordered()+
theme(legend.position="none")+
labs(title= "Разходи на НЗОК за таргетни онкологични медикаменти",
y=" десетичен логаритъм на разходите", x= " ") + theme(axis.title = element_text(family = "Courier")) +labs(alpha = 0.6)
cost_per_INN
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
year_dif =
rdf %>%
dplyr::filter(!year =="2021") %>%
group_by(year,INN) %>%
dplyr::summarise(costs= sum(QV)+1) %>%
dplyr::mutate(costs = log(costs)) %>%
ggbetweenstats(
x     = year,
y     = costs,
type = "p",
outlier.tagging = TRUE,
outlier.label = INN,
title = "Разпределение на разходите по години")+
xlab(" ")+
ylab("Разходи за година (логаритъм)")
year_dif
costs = rdf %>%
group_by(year_Q) %>%
dplyr::summarise(sum(QV)) %>%
flextable(col_keys = c("тримесечен период", "Разходи в лв.",))
costs = rdf %>%
group_by(year_Q) %>%
dplyr::summarise(sum(QV)) %>%
flextable(col_keys = c("тримесечен период", "Разходи в лв."))
costs
costs = rdf %>%
group_by(year_Q) %>%
dplyr::summarise(sum(QV)) %>%
flextable(col_keys = c("тримесечен период", "Разходи в лв."))
costs
costs = rdf %>%
group_by(year_Q) %>%
dplyr::summarise(sum(QV)) %>%
flextable(col_keys = c("тримесечен период", "Разходи в лв.")) %>%   autofit()
costs
costs = rdf %>%
group_by(year_Q) %>%
dplyr::summarise(sum(QV)) %>%
flextable()
costs
costs = rdf %>%
group_by(year_Q) %>%
dplyr::summarise(sum=sum(QV)) %>%
flextable() %>%
set_header_labels(
values = list(
year_Q = "тримесечен период",
sum = "разходи в лв."))%>%
autofit()
costs
source("~/GitHub/data_analysis/OTBI/OTBI.Rmd", encoding = 'UTF-8')
plot_Q_cost = rdf %>%
group_by(year_Q) %>%
dplyr::summarise(sum= sum(QV)) %>%
ggplot(aes(year_Q, sum, fill= year_Q))+
geom_col()+
scale_y_continuous(labels=scales::dollar_format(scale = .001, suffix = " мил.лв", prefix = " "))+
coord_flip()+
theme(legend.position="none")+
labs(title= "Разходи на НЗОК за таргетни онкологични медикаменти", subtitle = " в милиони лева, по тримесечие",
y=" ", x= " ")+
geom_smooth()
plot_Q_cost
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_smooth()+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_smooth(aes(rate))+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_smooth(aes(year_Q))+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_smooth(aes(year_Q))+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_smooth(aes(year_Q))
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_smooth(aes(rate))
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_smooth(aes(x=year_Q, y=rate))
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_point()+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_point()+
geom_smooth()+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_smooth(aes(x=as.numeric(year_Q), y=rate, fill=year_Q))+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom = c("col", "smooth")+
geom_smooth(aes(x=as.numeric(year_Q), y=rate, fill=year_Q))+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_smooth(aes(x=as.numeric(year_Q), y=rate, fill=year_Q))+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_line()+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_line(aes(x=year_Q, y=rate))+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_line(aes(y=year_Q, x=rate))+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_line(aes(x=year_Q, y=rate))+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df= rdf %>%
group_by(year_Q) %>%
summarise(cost= sum(QV)) %>%
mutate(rate = (((cost/lag(cost))*100)-100)/100) %>%
ungroup() %>%
ggplot(mapping=aes(x=year_Q, y=rate, fill=year_Q)) +
geom_col() +
geom_line(aes(x=year_Q, y=rate),stat="identity")+
scale_y_continuous(labels = scales::percent)+
coord_flip()+
theme(legend.position="none")+
labs(title= " Верижен индекс на промяна по отчетни тримесечия",
y=" индекс на промяна (в %)",
x= " ") +
annotate(xmin = '2020 Q4', xmax = '2021 Q2', ymin = -Inf,
ymax = Inf, geom = 'rect', alpha = 0.2)+
annotate(geom = "text", x = 17, y = 1.5,
label = "Economic impact of COVID-19",
hjust = "right", size=7)
time_df
time_df
source("~/GitHub/data_analysis/OTBI/OTBI.Rmd", encoding = 'UTF-8')
year<- c(2000,2000,2000,2001,2001,2001,2002,2002,2002)
k<- c(12.5,11.5,10.5,-8.5,-9.5,-10.5,13.9,14.9,15.9)
pop<- c(143,147,154,445,429,430,178,181,211)
pop_obs<- c(150,150,150,440,440,440,185,185,185)
df<- data_frame(year,k,pop,pop_obs)
df
library(tidyverse)
data_you_want = group_by(year, k)%>%
mutate(dif=pop-pop_obs)
data_you_want = df %>%
group_by(year, k)%>%
mutate(dif=pop-pop_obs)
data_you_want
data_you_want = df %>%
group_by(year, k)%>%
mutate(dif=pop-pop_obs)%>%
arrange(desc(dif))
data_you_want
library(tidyverse)
data_you_want = df %>%
group_by(year, k)%>%
mutate(dif=pop-pop_obs)%>%
arrange(desc(dif)) %>%
select(year, k)
data_you_want
library(tidyverse)
data_you_want = df %>%
group_by(year, k)%>%
mutate(dif=pop-pop_obs)%>%
arrange(desc(dif),.by_group = TRUE) %>%
select(year, k)
data_you_want
library(tidyverse)
data_you_want = df %>%
group_by(year, k)%>%
mutate(dif=pop-pop_obs)%>%
ungroup() %>%
arrange(desc(dif)) %>%
select(year, k)
library()
data_you_want
source("~/GitHub/data_analysis/OTBI/OTBI.Rmd", encoding = 'UTF-8')
